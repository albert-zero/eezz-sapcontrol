<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>SAP Management Console</title>
<style>
 .table { 
   display    : table;
   text-align : left;
   margin-left: 20px;
   margin-top : 10px 
}
</style>
<script>

function includeHTML() {
	x_elem = document.getElementsByName('aEntryDiv')[0];
	x_file = x_elem.getAttribute("data-eezz-file");

	xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
	  if (this.readyState == 4) {
	    if (this.status == 200) {x_elem.innerHTML = this.responseText;}
	    if (this.status == 404) {x_elem.innerHTML = "Page not found.";}
	    /*remove the attribute, and call this function once more:*/
	    x_elem.removeAttribute("data-eezz-file");
	  }
	}
	xhttp.open("GET", "http://www.google.com", true);
    xhttp.send();
}
document.addEventListener("selectionchange", function() {
	  console.log('Selection changed.'); 
	});
</script>

</head>

<body>


 <h1>SAP Management Console</h1>
 <div name='aEntryDiv' data-eezz-file='LinkDocu'></div>
 <p>
	 You can add snapshots generated by sapcontrol and SAP-MMC or life links to the console view.
	 The life links interact with the view to update the display status.
 </p>
 
 <h2>Startup</h2>
 <p onselectionchange="function() { alert('selection changed'); }">
	 The console starts with three sections.
	 <ul>
		 <li>Left: Tree Navigation</li>
		 <li>Upper Right: Commands View</li>
		 <li>Lower Right: Data View</li>
	 </ul>
	 
	 If the first column is not empty, it contains a handle to expand or collaps a tree segment.
	 A click on the other columns will open a view in the upper right console window with more commands on the selected element.
	 Tree elements in this view have a context menu, which opens if you select an entry. A context menu closes, if you chick into 
	 the table, no matter if you select an activity. 
 </p>
 <p><img src="sammmc.PNG" style="max-width:600px;"></p>

<p>
     The data section displays a navigation bar, if the number of entries exceed a given threshold. Only a very limited 
     number of elements are rendered for output, which ensures maximal perfomrance.
</p>    

 <h2>Managing database access</h2>
 <p>
     The connection to the backend is defined in JSON attributes within the HTML tags.
     <ul>
        <li>data-eezz-action: connect a named tag with an ABAP obect</li>
        <li>data-eezz-event: defines an input event</li>
        <li>data-eezz-async: defines asynchron input and motion</li>
        <li>data-eezz-template: defines an element to select for processing</li>     
     </ul>
 </p>
     
     <h3>data-eezz-action</h3>
     To access the backend, an object has be be created and stored into a local variable. The content of the following
     schematic tag would create an instance of class ZCL_SAPCONTROL and assigns this to the local variable <code>aSapControl</code>:     

     <div class="table">
        <div><code>&lt; ... name = aSapControl ... <b>data-eezz-action</b> assign ZCL_SAPCONTROL( ) ... &gt;</code></div></div> 

     <h3>data-eezz-template</h3>
     We could now call all methods, which returns a class of type <code>ZCL_EEZZ_TABLE</code>, which represents a table of data. The
     server is able to render the data into a table tag using the template elements: 
     
     <div class="table">
        <div><code>&lt;table name = aProcessList ... <b>data-eezz-action</b> assign aSapControl.Get_ProcessList( ) ... &gt;</code></div>  
        <div style="margin-left:20px"><code>&lt;tr <b>data-eezz-template</b> range-of-rows&gt;</code></div> 
        <div style="margin-left:40px"><code>&lt;td <b>data-eezz-template</b> range-of-columns&gt;</code></div></div>  
 
 
    <h3>data-eezz-event</h3>
    The data-eezz-event could be used to communicate with the backend. The following call defines a call to the login procedure
    and an update on the current screen. For the arguments its possible to access all named tags on the page.
    In the example below there is an input tag named <code>aUser</code> and the system reads the attribute <code>value</code>. 
    For the update the methods defined in
    <code>data-eezz-action</code> for the element on the right side is executed and the result is rendered into the element on the left
    side. This allows us to display the SAPSystemsList in different positions on the page.

     <div class="table"><code>    
         <div>&lt;button <b>data-eezz-event</b> </div> 
         <div style="margin-left:20px">callback  aSapControl.LOGIN( path=localhost, user=aUser.value, password=aPasswd.value ),</div>
         <div style="margin-left:20px">update    SystemsHdr.innerHTML : SAPSystemsList.innerHTML </div>
      </code></div>
 
 
 
    <h3>data-eezz-script</h3>
    The target <code>script</code> is used to execute a JavaScript to fill the inner HTML of a destination after calling the 
    ABAP callback methods.
     <div class="table">
        <div><code>&lt;... <b>data-eezz-action</b> ... <b>update</b>... ConsoleDetail.<b>script:sapcrtl.initialize[]()</b> ... &gt;</code></div></div>  
    
     <p>
     The JavaScript has a defined interface. The square brackets define a selector for the entire page and the framework would 
     pass all elements, which could be found to the script. The default would pass the new and the old elements of the table.
     </p>
     <p> 
     The script above relates to the following implementation. The function is generator with two arguments. The first contains 
     the selected elements and context, the second additional arguments.
     
     <div class="table">
         <div><code>var sapctrl = {</code></div>
         <div style="margin-left:20px"><code>initialize: function* ( xJsonArgs, xCmdArgs ) {</code></div>
         <div style="margin-left:40px"><code>xJsonArgs.update();</code></div>
         <div style="margin-left:40px"><code>var x_dest = xJsonArgs.updnew.elements[0];</code></div>
         <div style="margin-left:40px"><code>var x_ref  = x_dest.getAttribute('data-eezz-include');</code></div>
         <div style="margin-left:40px"><code>includeHTML( x_dest, x_ref );}</code></div></div>

    <h2>Managing Trees</h2>
       To manage updates and insertions, the framework has to identify tree elements within the tree.
       Tree nodes are identified by classes
       <ul>
            <li>TreeNodeRoot</li>
            <li>TreeNode</li>
            <li>eezzTreeHead</li>
            <li>eezzTreeBody</li>
            <li>eezzTreeMenu</li>
       </ul>  
       <p>      
       The <code>TreeNodeRoot</code> defines a root element of a tree and is defined for elements with TABLE tag.
       </p>
       
		<p>
		The <code>TreeNode</code> attribute is defined for tag elements TR only. It defines a <code>data-eezz-event</code>
		with an update, which should be inserted a child node.
		The child node is inserted as table with class <code>eezzTreeHead</code> and <code>eezzTreeBody</code>. 
		Update events of its child elements will choose the same destination, so that tree nodes are inserted 
		consistently.
		</p>
              
        <p>
        The same event on an expanded tree node will collapse the subtree, without launching a server request.       
        </p>
       
        <p>
        Calling the backend it is most important to know the path of the parent node, so that the correct subtree could
        be generated. The attribute <code>data-eezz-path</code> is generated and could be used in method calls.
        The path attribute concatenates <code>name</code> attributes of the elements in the direct tree and <code>name</code> 
        attribute are generated based on the database key.
        </p>
        
        <p>
        Sub-nodes in the tree are created with tag TR and class <code>eezzTreeHead</code>. 
        The content is a table column element TD containing
        one TABLE element with class <code>eezzTreeBody</code>. The latter defines the left margin of a tree hierarchy. 
        This classes should not be used explicitly and are designed for internal usage.
        </p>
        
        <p>
        A special sub-node is the class <code>eezzTreeMenu</code>, which is placed over the calling row and is not integrated
        into the tree. After selecting an entry such a tree segment is removed again. The tree path is exported to this element,
        so it could be used as modal dialog.
        </p>
        
</body>
</html>